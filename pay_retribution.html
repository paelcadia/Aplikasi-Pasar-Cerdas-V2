<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pasar Cerdas - Bayar Retribusi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* Mengatur body dan font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; 
        }
        
        /* Style Khas: Header Lengkung */
        .header-curve {
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }

        /* Styling untuk custom select */
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Kontainer Aplikasi Penuh: Lebar penuh di semua ukuran -->
    <div class="app-container w-full bg-white relative overflow-y-auto min-h-screen">

        <!-- 1. HEADER (Lengkung Biru) -->
        <div class="header-curve bg-[#0060AF] pt-8 pb-10 px-6 shadow-lg relative overflow-hidden">
            
            <!-- Ornamen Background -->
            <div class="absolute inset-0 pointer-events-none z-0">
                <div class="absolute top-[-20px] right-[-20px] w-32 h-32 bg-white opacity-10 rounded-full"></div>
                <div class="absolute top-[60px] left-[-40px] w-24 h-24 bg-white opacity-10 rounded-full"></div>
            </div>

            <!-- Konten Header Atas -->
            <div class="relative z-10 flex items-center text-white max-w-7xl mx-auto">
                <!-- Tombol Kembali -->
                <a href="main_dashboard.html" class="bg-white/20 hover:bg-white/30 p-2 rounded-full transition backdrop-blur-sm">
                    <i class="ph-bold ph-arrow-left text-xl"></i>
                </a>
                <h1 class="text-xl font-bold tracking-tight ml-4">Bayar Retribusi</h1>
            </div>
            
        </div>

        <!-- 2. KONTEN UTAMA (Floating Layout) -->
        <main class="flex-grow px-5 -mt-6 relative z-20 pb-20 max-w-7xl mx-auto">
            
            <!-- CARD 1: Detail Kios (Statik) -->
            <div class="bg-white rounded-2xl p-5 shadow-lg mb-4 border border-gray-100">
                <h2 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2">
                    <i class="ph-bold ph-storefront text-[#0060AF]"></i> Detail Kios
                </h2>
                
                <div class="space-y-2 text-sm">
                    <!-- Kios ID -->
                    <div class="flex justify-between">
                        <span class="text-gray-500">ID Kios/Lokasi</span>
                        <span class="font-semibold text-gray-700">K001 / Blok C, No. 05</span>
                    </div>
                    <!-- Nama Pedagang -->
                    <div class="flex justify-between">
                        <span class="text-gray-500">Nama Pedagang</span>
                        <span class="font-semibold text-gray-700">Muhammad Farhan Harsya</span>
                    </div>
                    <!-- Pasar -->
                    <div class="flex justify-between">
                        <span class="text-gray-500">Pasar</span>
                        <span class="font-semibold text-gray-700">Pasar Induk Soreang</span>
                    </div>
                    <!-- Jenis Dagangan -->
                    <div class="flex justify-between">
                        <span class="text-gray-500">Jenis Dagangan</span>
                        <span class="font-semibold text-gray-700">Buah-buahan Segar</span>
                    </div>
                </div>
            </div>

            <!-- CARD 2: Periode Tagihan (Dropdown) -->
            <div class="bg-white rounded-2xl p-5 shadow-lg mb-4 border border-gray-100">
                <h2 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2">
                    <i class="ph-bold ph-calendar text-[#0060AF]"></i> Periode Tagihan
                </h2>
                <label for="billingPeriod" class="block text-sm font-medium text-gray-600 mb-1">Pilih Bulan Tagihan <span class="text-red-500">*</span></label>
                <div class="relative">
                    <select id="billingPeriod" required
                            class="custom-select w-full px-4 py-3 border border-gray-300 rounded-xl bg-white text-gray-800 font-semibold focus:outline-none focus:border-[#0060AF] focus:ring-1 focus:ring-[#0060AF] transition">
                        <option value="current">November 2025</option>
                        <option value="previous">Oktober 2025</option>
                        <option value="late">September 2025 (Lewat Jatuh Tempo)</option>
                    </select>
                </div>
            </div>

            <!-- CARD 3: Rincian Pembayaran (Dinamic) -->
            <div id="billingDetailsCard" class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                <h2 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2">
                    <i class="ph-bold ph-receipt text-[#0060AF]"></i> Rincian Pembayaran
                </h2>
                
                <div class="space-y-3 text-sm">
                    <!-- Detail Retribusi -->
                    <div class="flex justify-between">
                        <span class="text-gray-500">Retribusi Kebersihan</span>
                        <span id="priceKebersihan" class="font-medium text-gray-700">Rp 50.000</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Retribusi Keamanan</span>
                        <span id="priceKeamanan" class="font-medium text-gray-700">Rp 30.000</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Retribusi Harian (Bulanan)</span>
                        <span id="priceHarian" class="font-medium text-gray-700">Rp 15.000</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Biaya Administrasi</span>
                        <span id="priceAdmin" class="font-medium text-gray-700">Rp 2.500</span>
                    </div>
                    
                    <!-- Denda/Late Fee (Muncul jika periode "late") -->
                    <div id="lateFeeContainer" class="hidden flex justify-between text-red-600 font-semibold pt-2 border-t border-dashed">
                        <span class="flex items-center gap-1"><i class="ph-bold ph-warning-circle"></i> Denda Keterlambatan</span>
                        <span id="lateFee">Rp 10.000</span>
                    </div>
                </div>

                <div class="border-t border-solid border-gray-200 mt-4 pt-4 flex justify-between text-base font-bold text-gray-800">
                    <span>Total Pembayaran</span>
                    <span id="totalPayment">Rp 97.500</span>
                </div>
            </div>
            
        </main>

        <!-- 3. Tombol Aksi Bawah (Fixed) -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 z-30 shadow-2xl shadow-gray-200">
            <div class="max-w-7xl mx-auto">
                <button id="payButton" 
                        class="w-full bg-[#0060AF] text-white font-bold py-3 rounded-xl transition shadow-lg shadow-blue-300/50 hover:bg-[#004a8c]">
                    <i class="ph-bold ph-credit-card mr-2"></i> Lanjut Bayar
                </button>
            </div>
        </div>

    </div>
    <!-- End Kontainer Aplikasi Penuh -->

    <script>
        // Global variables for Firebase configuration (Mandatory for Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        
        // FIX: Menggunakan __initial_auth_token untuk inisialisasi, bukan merujuk pada dirinya sendiri (initialAuthToken)
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 
        
        // --- Dummy Data Setup ---
        const ADMIN_FEE = 2500;
        const LATE_FEE = 10000;
        const BASE_CHARGES = {
            kebersihan: 50000,
            keamanan: 30000,
            harian: 15000 
        };
        const TOTAL_BASE_CHARGE = BASE_CHARGES.kebersihan + BASE_CHARGES.keamanan + BASE_CHARGES.harian;

        // --- DOM Elements ---
        const billingPeriod = document.getElementById('billingPeriod');
        const lateFeeContainer = document.getElementById('lateFeeContainer');
        const lateFeeDisplay = document.getElementById('lateFee');
        const priceKebersihan = document.getElementById('priceKebersihan');
        const priceKeamanan = document.getElementById('priceKeamanan');
        const priceHarian = document.getElementById('priceHarian');
        const priceAdmin = document.getElementById('priceAdmin');
        const totalPayment = document.getElementById('totalPayment');
        const payButton = document.getElementById('payButton');

        /**
         * Fungsi untuk memformat angka menjadi mata uang Rupiah
         * @param {number} amount 
         */
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        /**
         * Fungsi untuk menampilkan Modal Kustom (pengganti alert/confirm)
         * @param {string} title - Judul modal
         * @param {string} message - Isi pesan
         * @param {function} onConfirm - Callback saat tombol 'Proses' ditekan
         */
        function showCustomModal(title, message, onConfirm = null) {
            const existingModal = document.querySelector('.custom-modal-overlay');
            if (existingModal) existingModal.remove();

            const customModal = document.createElement('div');
            customModal.className = 'custom-modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 transition-opacity duration-300 opacity-0';
            
            const confirmButtonHtml = onConfirm ? `<button id="confirmAction" class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 transition">Proses</button>` : '';

            customModal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-transform duration-300 scale-95">
                    <h3 class="text-xl font-bold text-[#0060AF] mb-3">${title}</h3>
                    <p class="text-gray-700 whitespace-pre-line text-sm mb-5">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button id="closeModal" class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 border border-gray-300 hover:bg-gray-100 transition">Batal</button>
                        ${confirmButtonHtml}
                    </div>
                </div>
            `;
            document.body.appendChild(customModal);

            // Animate in
            setTimeout(() => {
                customModal.classList.remove('opacity-0');
                customModal.querySelector('div').classList.remove('scale-95');
            }, 10);


            document.getElementById('closeModal').addEventListener('click', () => {
                customModal.remove();
            });
            
            if (onConfirm) {
                document.getElementById('confirmAction').addEventListener('click', () => {
                    customModal.remove();
                    onConfirm();
                });
            }
        }


        /**
         * Fungsi untuk memperbarui rincian tagihan berdasarkan pilihan periode
         */
        function updateBillingDetails() {
            const periodValue = billingPeriod.value;
            let currentLateFee = 0;
            let totalAmount = TOTAL_BASE_CHARGE + ADMIN_FEE;
            
            // 1. Cek Denda Keterlambatan (Simulasi)
            if (periodValue === 'late') {
                currentLateFee = LATE_FEE;
                totalAmount += currentLateFee;
                lateFeeContainer.classList.remove('hidden');
            } else {
                lateFeeContainer.classList.add('hidden');
            }

            // 2. Update Rincian Harga Statis
            priceKebersihan.textContent = formatRupiah(BASE_CHARGES.kebersihan);
            priceKeamanan.textContent = formatRupiah(BASE_CHARGES.keamanan);
            priceHarian.textContent = formatRupiah(BASE_CHARGES.harian);
            priceAdmin.textContent = formatRupiah(ADMIN_FEE);
            lateFeeDisplay.textContent = formatRupiah(currentLateFee);

            // 3. Update Total
            totalPayment.textContent = formatRupiah(totalAmount);
        }

        // Event Listeners
        billingPeriod.addEventListener('change', updateBillingDetails);
        
        // Tombol Lanjut Bayar (Navigasi ke halaman konfirmasi)
        payButton.addEventListener('click', () => {
            const periodText = billingPeriod.options[billingPeriod.selectedIndex].textContent;
            const totalText = totalPayment.textContent;
            
            const message = `Anda akan melanjutkan ke halaman konfirmasi pembayaran untuk:\n- Periode: ${periodText}\n- Total: ${totalText}\n\nLanjutkan proses ini?`;
            
            // Menggunakan modal kustom sebagai pengganti alert()
            showCustomModal(
                "Konfirmasi Pembayaran",
                message,
                () => {
                    // Tindakan saat user menekan 'Proses'
                    // NAVIGASI EKSPLISIT KE HALAMAN BERIKUTNYA
                    window.location.href = 'payment_confirmation.html';
                }
            );
        });

        // Panggil saat halaman dimuat
        document.addEventListener('DOMContentLoaded', updateBillingDetails);
    </script>
</body>
</html>